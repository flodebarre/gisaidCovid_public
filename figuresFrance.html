<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="FD" />

<meta name="date" content="2021-07-21" />

<title>France on GISAID</title>

<script src="figuresFrance_files/header-attrs-2.7/header-attrs.js"></script>
<script src="figuresFrance_files/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="figuresFrance_files/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="figuresFrance_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="figuresFrance_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="figuresFrance_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="figuresFrance_files/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="figuresFrance_files/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="figuresFrance_files/tocify-1.9.1/jquery.tocify.js"></script>
<script src="figuresFrance_files/navigation-1.1/tabsets.js"></script>
<script src="figuresFrance_files/navigation-1.1/codefolding.js"></script>
<link href="figuresFrance_files/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="figuresFrance_files/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>








<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-sm-12 col-md-4 col-lg-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-sm-12 col-md-8 col-lg-9">




<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">France on GISAID</h1>
<h4 class="author">FD</h4>
<h4 class="date">2021-07-21</h4>

</div>


<div id="initializations" class="section level1">
<h1>Initializations</h1>
<pre class="r"><code># Colors 
library(RColorBrewer)
colsV &lt;- rep(c(brewer.pal(12, &quot;Paired&quot;), brewer.pal(12, &quot;Set3&quot;), brewer.pal(9, &quot;Set1&quot;)), 20)
colsP &lt;- brewer.pal(5, &quot;Set1&quot;)
names(colsP) &lt;- c(&quot;autre&quot;, &quot;HCL&quot;, &quot;HMN&quot;, &quot;IHU&quot;, &quot;IPP&quot;)
colsC &lt;- c(brewer.pal(9, &quot;Set1&quot;), brewer.pal(6, &quot;Set2&quot;), brewer.pal(12, &quot;Set3&quot;))
colsV2 &lt;- brewer.pal(9, &quot;Set3&quot;)

colGISAID &lt;- &quot;#106b63&quot;
colECDC &lt;- &quot;#69b023&quot;
colSPF &lt;- &quot;#e30155&quot;

cols &lt;- c(colGISAID, colECDC, colSPF, &quot;#FE6100&quot;, &quot;#785EF0&quot;)
names(cols) &lt;- c(&quot;GISAID&quot;, &quot;TESSy&quot;, &quot;Flash&quot;, &quot;criblage&quot;, &quot;option&quot;)

pchs &lt;- c(16, 15, 2, 17, 1)
names(pchs) &lt;- c(names(cols)[1:3], &quot;Flash2&quot;, &quot;TESSyGISAID&quot;)</code></pre>
<pre class="r"><code># Function to identify entries that are NA or empty
is.NAempty &lt;- function(x){
  is.na(x) | x == &quot;&quot;
}</code></pre>
</div>
<div id="load-and-clean-data" class="section level1">
<h1>Load and clean data</h1>
<p>Data source: <code>metadata.tsv</code>, downloaded from <a href="https://www.gisaid.org">GISAID</a>.</p>
<p>Then, in console</p>
<pre><code>grep &quot;hCoV-19/France&quot; metadata.tsv</code></pre>
<p>to extract sequences from France (as country) only. The resulting file is stored in the <code>data/</code> folder.</p>
<p>Note: Oversea territories are referenced as independent on GISAID</p>
<div id="load-data" class="section level2">
<h2>Load data</h2>
<pre class="r"><code>dat &lt;- read.csv(&quot;data/2021-07-20_France.tsv&quot;, sep = &quot;\t&quot;, stringsAsFactors = FALSE, header = FALSE)
head(dat)
names(dat) &lt;- c(&quot;Virus.name&quot;, &quot;Type&quot;, &quot;Accession.ID&quot;, &quot;Collection.date&quot;, &quot;Location&quot;, &quot;Additional.location.information&quot;, &quot;Sequence.length&quot;, &quot;Host&quot;, &quot;Patient.age&quot;, &quot;Gender&quot;, &quot;Clade&quot;, &quot;Pango.lineage&quot;, &quot;Pangolin.version&quot;, &quot;Variant&quot;, &quot;AA.Substitutions&quot;, &quot;Submission.date&quot;, &quot;Is.reference&quot;, &quot;Is.complete&quot;, &quot;Is.high.coverage&quot;, &quot;Is.low.coverage&quot;, &quot;N.Content&quot;, &quot;GC.Content&quot;)</code></pre>
<p>There are 57438 lines in the dataset.</p>
</div>
<div id="clean-data" class="section level2">
<h2>Clean data</h2>
<p>Dates: full date, year-month and year</p>
<pre class="r"><code># Reformat dates

# Table of the lengths of the different dates
table(nchar(dat$Collection.date)) # There are incomplete dates
table(nchar(dat$Submission.date))

# Turn dates into date format, and put NA for incomplete dates
getDate &lt;- function(v){
  out &lt;- v
  # Remove lines with incomplete date information
  out[nchar(out) &lt; 10] &lt;- NA
  base::as.Date(out)
}

dat$Collection.date.YMD &lt;- getDate(dat$Collection.date)
dat$Submission.date.YMD &lt;- getDate(dat$Submission.date)

# Extract month
getYM &lt;- function(v){
  out &lt;- v
  # Remove lines with incomplete date information
  out[nchar(out) &lt; 7] &lt;- NA
  substr(out, 1, 7)
}

dat$Collection.date.YM &lt;- getYM(dat$Collection.date)
dat$Submission.date.YM &lt;- getYM(dat$Submission.date)

# Extract year
getY &lt;- function(v){
  out &lt;- v
  # Remove lines with incomplete date information
  out[nchar(out) &lt; 4] &lt;- NA
  substr(out, 1, 4)
}

dat$Collection.date.Y &lt;- getY(dat$Collection.date)
dat$Submission.date.Y &lt;- getY(dat$Submission.date)</code></pre>
<p>Dates: get week numbers<br />
(currently only done for 2021)</p>
<pre class="r"><code># NOTE: THIS IS ONLY FOR 2021 -- need to change method for 2020, or do it separately

endDay &lt;- max(dat$Submission.date.YMD)
beginDay &lt;- seq(base::as.Date(&quot;2021-01-04&quot;), base::as.Date(&quot;2021-12-27&quot;), by = 7)
endDay &lt;- seq(base::as.Date(&quot;2021-01-10&quot;), base::as.Date(&quot;2022-01-02&quot;), by = 7)
weeks &lt;- as.data.frame(cbind(weekBegin = beginDay, weekEnd = endDay, week = 1:52))


# Assign weeks
  # Initialize week numbers
dat$Collection.week &lt;- NA
dat$Submission.week &lt;- NA

for(iw in weeks$week){
  # Collection week
  dat[which(base::as.Date(dat$Collection.date.YMD) &gt;= base::as.Date(weeks[iw, &quot;weekBegin&quot;], origin = &quot;1970-01-01&quot;) &amp; base::as.Date(dat$Collection.date.YMD) &lt;= base::as.Date(weeks[iw, &quot;weekEnd&quot;], origin = &quot;1970-01-01&quot;)), &quot;Collection.week&quot;] &lt;- iw
  
  # Submission week
  dat[which(base::as.Date(dat$Submission.date.YMD) &gt;= base::as.Date(weeks[iw, &quot;weekBegin&quot;], origin = &quot;1970-01-01&quot;) &amp; base::as.Date(dat$Submission.date.YMD) &lt;= base::as.Date(weeks[iw, &quot;weekEnd&quot;], origin = &quot;1970-01-01&quot;)), &quot;Submission.week&quot;] &lt;- iw
}</code></pre>
<p>Difference between submission and collection dates</p>
<pre class="r"><code>dat$diffSubCol &lt;- as.numeric(dat$Submission.date.YMD - dat$Collection.date.YMD)</code></pre>
<p>Locations:<br />
Try to get some uniformity automatically because some spellings differ</p>
<pre class="r"><code># Extract locations
# Reformat locations: 
# 1) Remove spaces
locs &lt;- gsub(&quot; &quot;, &quot;&quot;, dat$Location)
# 2) Convert to upper case
locs &lt;- toupper(locs)
# 3) Remove dashes
locs &lt;- gsub(&quot;-&quot;, &quot;&quot;, locs)
locs &lt;- gsub(&quot;_&quot;, &quot;&quot;, locs)
# 4) Remove some accents
#    A 
for(char in c(&quot;À&quot;, &quot;Â&quot;, &quot;Ä&quot;)){
  locs &lt;- gsub(char, &quot;A&quot;, locs)
}
#    E 
for(char in c(&quot;È&quot;, &quot;É&quot;, &quot;Ê&quot;)){
  locs &lt;- gsub(char, &quot;E&quot;, locs)
}
#    I 
for(char in c(&quot;Î&quot;)){
  locs &lt;- gsub(char, &quot;I&quot;, locs)
}
#    O 
for(char in c(&quot;Ô&quot;)){
  locs &lt;- gsub(char, &quot;O&quot;, locs)
}

# Split locations
# Locations are presented as a single string, which we split
locs &lt;- strsplit(locs, &quot;/&quot;)
# The strings are of different lengths / precision; get length (number of geographic divisions)
lenlocs &lt;- sapply(locs, length)
table(lenlocs)
# Turn into matrix, filling with NAs
# Source: https://stackoverflow.com/a/15201690
mat &lt;- as.data.frame(t(sapply(locs, &quot;[&quot;, i = 1:max(lenlocs))))
names(mat) &lt;- c(&quot;continent&quot;, &quot;country&quot;, &quot;region&quot;, &quot;div4&quot;, &quot;div5&quot;)
dat &lt;- cbind(dat, mat)
# Also add information about location precision
dat &lt;- cbind(dat, locationLength = lenlocs)
names(dat)</code></pre>
<p>Hosts</p>
<pre class="r"><code># Uniformize notation
dat[dat$Host == &quot;human&quot;, &quot;Host&quot;] &lt;- &quot;Human&quot;</code></pre>
</div>
<div id="flash" class="section level2">
<h2>Flash</h2>
<p>Load Flash dates</p>
<pre class="r"><code>datesFlash &lt;- read.csv(&quot;../gisaid_covid/data/datesFlash.csv&quot;, stringsAsFactors = FALSE, header = FALSE)
names(datesFlash) &lt;- c(&quot;FlashNb&quot;, &quot;date&quot;, &quot;date2&quot;, &quot;week&quot;)
datesFlash.all &lt;- datesFlash
# Remove Flash 1 and 2, which were not on a random sample
datesFlash &lt;- datesFlash[datesFlash$FlashNb &gt;=3 , ]</code></pre>
<p>Flash data Typed from <a href="https://www.santepubliquefrance.fr/etudes-et-enquetes/enquetes-flash-evaluation-de-la-circulation-des-variants-du-sars-cov-2-en-france#block-337272" class="uri">https://www.santepubliquefrance.fr/etudes-et-enquetes/enquetes-flash-evaluation-de-la-circulation-des-variants-du-sars-cov-2-en-france#block-337272</a>, accessed 2021-07-21</p>
<pre class="r"><code>dat.Flash &lt;- read.csv(&quot;data_public/2021-07-21_Flash.csv&quot;)
head(dat.Flash)</code></pre>
<pre><code>##   FlashNumber       Date week
## 1     Flash11 2021-06-08   23
## 2     Flash11 2021-06-08   23
## 3     Flash11 2021-06-08   23
## 4     Flash11 2021-06-08   23
## 5     Flash11 2021-06-08   23
## 6     Flash11 2021-06-08   23
##                                                       Variants Variant_short
## 1                                     20I (V1, B.1.1.7, Alpha)  Alpha_noEmut
## 2        20H (V2, B.1.351/B.1.351.1/B.1.351.2/B.1.351.3, Beta)          Beta
## 3                                        20J (V3, P.1, Gamma)          Gamma
## 4                                  20I/484K (B.1.1.7 + E484K)    Alpha_E484K
## 5                                   20I/484Q (B.1.1.7 + E484Q)   Alpha_E484Q
## 6 (B.1.617.2/AY.1/AY.2, Delta)21A (B.1.617.2/AY.1/AY.2, Delta)         Delta
##   Proportion NbPrelevSeq
## 1      0.770         808
## 2      0.094         808
## 3      0.004         808
## 4      0.023         808
## 5      0.001         808
## 6      0.085         808</code></pre>
<pre class="r"><code>dat.Flash$deltaCI &lt;- 1.96 * sqrt(dat.Flash$Proportion * (1 - dat.Flash$Proportion) / dat.Flash$NbPrelevSeq)</code></pre>
<p>Specific Flash data</p>
<pre class="r"><code># Load Flash 11 data
flash11 &lt;- read.csv(&quot;data_public/Flash11_Beta.csv&quot;)
flash11 &lt;- flash11[flash11$Region != &quot;Total&quot;, ]
flash11$nBeta &lt;- round(flash11$pBeta * flash11$Prelevements)

# Load Flash 10 data
flash10 &lt;- read.csv(&quot;data_public/Flash10_Beta.csv&quot;)
flash10 &lt;- flash10[flash10$Region != &quot;Total&quot;, ]
flash10$nBeta &lt;- round(flash10$pBeta * flash10$Prelevements)

# Load Flash 09 data
flash09 &lt;- read.csv(&quot;data_public/Flash09_Beta.csv&quot;)
flash09 &lt;- flash09[flash09$Region != &quot;Total&quot;, ]
flash09$nBeta &lt;- round(flash09$pBeta * flash09$Prelevements)

# Get codes of Outre-Mer regions
unique(c(flash09$Region, flash10$Region, flash11$Region))</code></pre>
<pre><code>##  [1] &quot;ARA&quot;  &quot;BFC&quot;  &quot;BRE&quot;  &quot;CVL&quot;  &quot;COR&quot;  &quot;GE&quot;   &quot;GUA&quot;  &quot;HDF&quot;  &quot;IDF&quot;  &quot;REU&quot; 
## [11] &quot;MAR&quot;  &quot;NOR&quot;  &quot;NAQ&quot;  &quot;OCC&quot;  &quot;PDL&quot;  &quot;PACA&quot; &quot;NR&quot;   &quot;MAY&quot;</code></pre>
<pre class="r"><code>reg_OM &lt;- c(&quot;GUA&quot;, &quot;REU&quot;, &quot;MAR&quot;, &quot;MAY&quot;)

# Remove Outre-Mer
flash11.noOM &lt;- flash11[which(!is.element(flash11$Region, reg_OM)), ]
flash10.noOM &lt;- flash10[which(!is.element(flash10$Region, reg_OM)), ]
flash09.noOM &lt;- flash09[which(!is.element(flash09$Region, reg_OM)), ]

# Compute total numbers of sequences, and Beta sequences
tot11 &lt;- apply(flash11.noOM[, c(&quot;Prelevements&quot;, &quot;nBeta&quot;)], 2, sum)
tot10 &lt;- apply(flash10.noOM[, c(&quot;Prelevements&quot;, &quot;nBeta&quot;)], 2, sum)
tot09 &lt;- apply(flash09.noOM[, c(&quot;Prelevements&quot;, &quot;nBeta&quot;)], 2, sum)

# Construct final dataset with the results
totFlash.noOM &lt;- data.frame(week = c(19, 21, 23))
totFlash.noOM$nTot &lt;- c(tot09[1], tot10[1], tot11[1])
totFlash.noOM$pBeta &lt;- c(tot09[2]/tot09[1], tot10[2]/tot10[1], tot11[2]/tot11[1])
totFlash.noOM$deltaCI &lt;- 1.96 * sqrt(totFlash.noOM$pBeta * (1-totFlash.noOM$pBeta) / totFlash.noOM$nTot)
totFlash.noOM</code></pre>
<pre><code>##   week nTot      pBeta    deltaCI
## 1   19 1659 0.06088005 0.01150617
## 2   21 1706 0.04220399 0.00954069
## 3   23  740 0.03513514 0.01326613</code></pre>
</div>
</div>
<div id="france" class="section level1">
<h1>France</h1>
<pre class="r"><code>table(country = dat$country)</code></pre>
<pre><code>## country
##     FRANCE GUADELOUPE 
##      57419         19</code></pre>
<pre class="r"><code># Keep only mainland France
dat &lt;- dat[dat$country == &quot;FRANCE&quot;, ]</code></pre>
<p>There are 57419 samples with location in France.</p>
<p>Get submitter information from Virus name</p>
<pre class="r"><code>ipp &lt;- grep(dat$Virus.name, pattern = &quot;IPP&quot;)
hcl &lt;- grep(dat$Virus.name, pattern = &quot;HCL&quot;)
ihu &lt;- grep(dat$Virus.name, pattern = &quot;IHU&quot;)
hmn &lt;- grep(dat$Virus.name, pattern = &quot;HMN&quot;)


dat$submitter &lt;- rep(&quot;autre&quot;, nrow(dat))
dat[ipp, &quot;submitter&quot;] &lt;- &quot;IPP&quot;
dat[hcl, &quot;submitter&quot;] &lt;- &quot;HCL&quot;
dat[ihu, &quot;submitter&quot;] &lt;- &quot;IHU&quot;
dat[hmn, &quot;submitter&quot;] &lt;- &quot;HMN&quot;

table(dat$submitter, useNA = &quot;ifany&quot;)</code></pre>
<pre><code>## 
## autre   HCL   HMN   IHU   IPP 
## 17666 10795  9255 10467  9236</code></pre>
<pre class="r"><code>submitters &lt;- sort(unique(dat$submitter))</code></pre>
<div id="sequence-metadata" class="section level2">
<h2>Sequence metadata</h2>
<p>Dates</p>
<ul>
<li>The fraction of samples with missing full day of collection is 0.19</li>
</ul>
<p>Distribution of samples with incomplete collection date information, by submitter</p>
<pre class="r"><code>totSeq &lt;- table(dat$submitter)
tt &lt;- table(dat[which(is.na(dat$Collection.date.YMD)), &quot;submitter&quot;])

rbind(incomplete_collectionDate = tt, tot_seq = totSeq[names(tt)])</code></pre>
<pre><code>##                           autre   IHU  IPP
## incomplete_collectionDate  3908  6672  292
## tot_seq                   17666 10467 9236</code></pre>
<p>Location</p>
<ul>
<li>The fraction of samples with missing regional information is 0.03</li>
</ul>
<p>Distribution of entries with incomplete location, by submitter</p>
<pre class="r"><code>tt &lt;- table(dat[which(is.na(dat$region)), &quot;submitter&quot;])

rbind(missing_region = tt, tot_seq = totSeq[names(tt)])</code></pre>
<pre><code>##                autre  HMN
## missing_region   821  749
## tot_seq        17666 9255</code></pre>
<p>Regions need to be standardized…</p>
<pre class="r"><code>sort(unique(dat$region))</code></pre>
<pre><code>##  [1] &quot;ALPESMARITIMES&quot;          &quot;ALSACE&quot;                 
##  [3] &quot;AQUITAINE&quot;               &quot;ARIEGE&quot;                 
##  [5] &quot;AUDE&quot;                    &quot;AUVERGNE&quot;               
##  [7] &quot;AUVERGNERHONEALPES&quot;      &quot;AVEYRON&quot;                
##  [9] &quot;BASSENORMANDIE&quot;          &quot;BOURGOGNE&quot;              
## [11] &quot;BOURGOGNEFRANCHECOMTE&quot;   &quot;BRETAGNE&quot;               
## [13] &quot;CENTRE&quot;                  &quot;CENTREVALDELOIRE&quot;       
## [15] &quot;CHAMPAGNEARDENNE&quot;        &quot;CORSE&quot;                  
## [17] &quot;COTED&#39;AZUR&quot;              &quot;GERS&quot;                   
## [19] &quot;GRANDEST&quot;                &quot;GRENOBLE&quot;               
## [21] &quot;GUYANE&quot;                  &quot;HAUTEGARONNE&quot;           
## [23] &quot;HAUTENORMANDIE&quot;          &quot;HAUTESPYRENEES&quot;         
## [25] &quot;HAUTRHIN&quot;                &quot;HAUTSDEFRANCE&quot;          
## [27] &quot;ILEDEFRANCE&quot;             &quot;LORRAINE&quot;               
## [29] &quot;LOT&quot;                     &quot;LOTETGARONNE&quot;           
## [31] &quot;MARSEILLE&quot;               &quot;MEUSE&quot;                  
## [33] &quot;NICE&quot;                    &quot;NORDPASDECALAIS&quot;        
## [35] &quot;NORMANDIE&quot;               &quot;NORMANDY&quot;               
## [37] &quot;NOUVELLEAQUITAINE&quot;       &quot;OCCITANIE&quot;              
## [39] &quot;PAC&quot;                     &quot;PAYSDELALOIRE&quot;          
## [41] &quot;PAYSDELOIRE&quot;             &quot;PICARDIE&quot;               
## [43] &quot;POITOUCHARENTES&quot;         &quot;PROVENCEALPESCOTEAZUR&quot;  
## [45] &quot;PROVENCEALPESCOTED&#39;AZUR&quot; &quot;PYRENEESORIENTALES&quot;     
## [47] &quot;RHONEALPES&quot;              &quot;TARN&quot;                   
## [49] &quot;TARNETGARONNE&quot;           &quot;VALD&#39;OISE&quot;</code></pre>
<div id="metadata-on-hosts" class="section level3">
<h3>Metadata on hosts</h3>
<pre class="r"><code># Hosts
table(dat$Host)</code></pre>
<pre><code>## 
## Human 
## 57419</code></pre>
<p>Age</p>
<pre class="r"><code># Age
dat[which(is.element(dat$Patient.age, c(&quot;unknown&quot;, &quot;Unknown&quot;))), &quot;Patient.age&quot;] &lt;- NA

# Convert to numeric values 
# if contains characters -&gt; NA
dat$Patient.age &lt;- suppressWarnings(as.numeric(dat$Patient.age))</code></pre>
<p>The fraction of samples with missing or incorrect age information is 0.3.</p>
<p>Missing age by submitter</p>
<pre class="r"><code>tt &lt;- table(dat[which(is.na(dat$Patient.age)), &quot;submitter&quot;])
rbind(missing_age = tt, tot_seq = totSeq[names(tt)])</code></pre>
<pre><code>##             autre   HCL  HMN   IHU  IPP
## missing_age  5524   842  125 10467  554
## tot_seq     17666 10795 9255 10467 9236</code></pre>
<p>Distribution of ages</p>
<pre class="r"><code>par(las = 1)
hist(dat$Patient.age, xlab = &quot;Patient age&quot;, main = &quot;Distribution of patient ages&quot;, breaks = seq(0, max(dat$Patient.age, na.rm = TRUE), by = 1), border = gray(1, 1), col = cols[1])</code></pre>
<p><img src="figuresFrance_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>“Gender” information</p>
<pre class="r"><code>unique(dat$Gender)
# Clean
dat[which(is.element(dat$Gender, c(&quot;unknown&quot;, &quot;Unknown&quot;, &quot;Femal&quot;, &quot;Maleale&quot;))), &quot;Gender&quot;] &lt;- NA

table(dat$Gender, useNA = &quot;ifany&quot;)</code></pre>
<pre class="r"><code># Distribution by submitter
rbind(missing_age = table(dat[which(is.na(dat$Gender)), &quot;submitter&quot;]), tot_seq = table(dat$submitter))</code></pre>
<pre><code>##             autre   HCL  HMN   IHU  IPP
## missing_age  4445   284  346 10465 2156
## tot_seq     17666 10795 9255 10467 9236</code></pre>
</div>
<div id="virus" class="section level3">
<h3>Virus</h3>
<pre class="r"><code># &quot;Clade&quot;                           &quot;Pango.lineage&quot;         
# &quot;Pangolin.version&quot;                &quot;Variant&quot;                 
# &quot;AA.Substitutions&quot;</code></pre>
<p>Clades</p>
<pre class="r"><code>table(dat$Clade, useNA = &quot;ifany&quot;)</code></pre>
<pre><code>## 
##     G    GH    GR   GRY    GV     L     O     S     V 
##  9951 11346  4085 28694  1802    34   889   573    45</code></pre>
<p>Pango lineage info is missing in a fraction 0 of items.</p>
<p>Pangolin version</p>
<pre class="r"><code>table(dat$Pangolin.version)</code></pre>
<pre><code>## 
## 2021-07-09 
##      57419</code></pre>
</div>
</div>
<div id="submissions" class="section level2">
<h2>Submissions</h2>
<div id="by-platform" class="section level3">
<h3>By Platform</h3>
<pre class="r"><code>tabFRsub &lt;- aggregate(dat$Virus.name, by = list(subID = dat$submitter, subM = dat$Collection.date.YM), FUN = length)

tabFRsub.month &lt;- aggregate(dat$Virus.name, by = list(subM = dat$Collection.date.YM), FUN = length)


par(mgp = c(3, 1, 0))
par(mar = c(5, 5, 3, 1))
x &lt;- barplot(tabFRsub$x ~ tabFRsub$subID + tabFRsub$subM, col = colsP[1:(length(unique(tabFRsub$subID)))], border = gray(0, 0), 
             xlab = &quot;&quot;, ylab = &quot;Nb sequences&quot;, las = 2, 
             main = &quot;Nombre de séquences par producteur et mois de collecte&quot;)

z &lt;- tabFRsub[tabFRsub$subM == &quot;2021-03&quot;, ]
text(x = rep(x[length(x)-1], 5), y = cumsum(z$x) - z$x/2, labels = z$subID, adj = c(-0.7, 0.5), col = colsP, cex = 0.9) # pos 4 for left-justified
par(xpd = TRUE)
text(x = x, y = tabFRsub.month$x, labels = tabFRsub.month$x, cex = 0.8, adj = c(0.5, -0.5))
legend(&quot;topleft&quot;, col = rev(colsP), legend = rev(names(colsP)), pch = 15, bty = &quot;n&quot;)</code></pre>
<p><img src="figuresFrance_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<pre class="r"><code>par(xpd = FALSE)</code></pre>
<p>By platform, by week</p>
<pre class="r"><code># By collection week
tabFRsub.byweek &lt;- aggregate(dat$Virus.name, by = list(subID = dat$submitter, subweek = dat$Collection.week), FUN = length)
names(tabFRsub.byweek)[3] &lt;- &quot;byCollectionDate&quot;

tabFRsubS.byweek &lt;- aggregate(dat$Virus.name, by = list(subID = dat$submitter, subweek = dat$Submission.week), FUN = length)
names(tabFRsubS.byweek)[3] &lt;- &quot;bySubmissionDate&quot;

seq.byWeek &lt;- merge(tabFRsub.byweek, tabFRsubS.byweek, all = TRUE)
ymax &lt;- 6000

seq.byWeek[is.na(seq.byWeek$byCollectionDate), &quot;byCollectionDate&quot;] &lt;- 0
seq.byWeek[is.na(seq.byWeek$bySubmissionDate), &quot;bySubmissionDate&quot;] &lt;- 0

par(mfrow = c(2, 1))
themar &lt;- c(3, 3.5, 2, 1)
thetck &lt;- -0.01
themgp &lt;- c(2.3, 0.3, 0)
par(mar = themar, mgp = themgp, tck = thetck)

x &lt;- barplot(seq.byWeek$byCollectionDate ~ seq.byWeek$subID + seq.byWeek$subweek, col = colsP[1:(length(unique(tabFRsub$subID)))], border = gray(0, 0), 
             xlab = &quot;&quot;, ylab = &quot;Nb sequences&quot;, las = 1, 
             main = &quot;Par semaine de prélèvement&quot;, xaxs = &quot;i&quot;, yaxs = &quot;i&quot;, ylim = c(0, ymax))
legend(&quot;topleft&quot;, col = rev(colsP), legend = rev(names(colsP)), pch = 15, bty = &quot;n&quot;)

stopifnot(length(x) == length(unique(seq.byWeek$subweek))) # Make sure that lengths match

xw &lt;- data.frame(cbind(x = x, week = unique(seq.byWeek$subweek)))
ii &lt;- is.element(xw$week, datesFlash.all$week)
par(xpd = TRUE)
text(labels = &quot;*&quot;, x = xw[ii, &quot;x&quot;], y = rep(-100, length(xw[ii, &quot;x&quot;])))
par(xpd = FALSE)
mtext(&quot;Semaine de prélèvement (* = semaine Flash)&quot;, side = 1, line = 1.25)


par(mar = themar, mgp = themgp, tck = thetck)
x2 &lt;- barplot(seq.byWeek$bySubmissionDate ~ seq.byWeek$subID + seq.byWeek$subweek, col = colsP[1:(length(unique(seq.byWeek$subID)))], border = gray(0, 0), 
             xlab = &quot;&quot;, ylab = &quot;Nb sequences&quot;, las = 1, 
             main = &quot;Par semaine de soumission&quot;, xaxs = &quot;i&quot;, yaxs = &quot;i&quot;, ylim = c(0, ymax))
legend(&quot;topleft&quot;, col = rev(colsP), legend = rev(names(colsP)), pch = 15, bty = &quot;n&quot;)
mtext(&quot;Semaine de soumission&quot;, side = 1, line = 1.25)</code></pre>
<p><img src="figuresFrance_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
</div>
</div>
<div id="lineages-over-time" class="section level2">
<h2>Lineages over time</h2>
<div id="variants" class="section level3">
<h3>Variants</h3>
<p>Use short names</p>
<pre class="r"><code>dat$VariantShort &lt;- dat$Variant

variants &lt;- sort(unique(dat$Variant))
# variants
variantsShort &lt;- c(&quot;&quot;, &quot;Alpha&quot;, &quot;Beta&quot;, &quot;Delta&quot;, &quot;Gamma&quot;, &quot;Epsilon&quot;, &quot;Eta&quot;, &quot;Iota&quot;, &quot;Kappa&quot;, &quot;Lambda&quot;, &quot;Zeta&quot;)
# Check
rbind(variants, variantsShort)</code></pre>
<pre><code>##               [,1] [,2]                                                        
## variants      &quot;&quot;   &quot;VOC Alpha 202012/01 GRY (B.1.1.7) first detected in the UK&quot;
## variantsShort &quot;&quot;   &quot;Alpha&quot;                                                     
##               [,3]                                                          
## variants      &quot;VOC Beta GH/501Y.V2 (B.1.351) first detected in South Africa&quot;
## variantsShort &quot;Beta&quot;                                                        
##               [,4]                                                               
## variants      &quot;VOC Delta G/478K.V1 (B.1.617.2+AY.1+AY.2) first detected in India&quot;
## variantsShort &quot;Delta&quot;                                                            
##               [,5]                                                       
## variants      &quot;VOC Gamma GR/501Y.V3 (P.1) first detected in Brazil/Japan&quot;
## variantsShort &quot;Gamma&quot;                                                    
##               [,6]                                                                       
## variants      &quot;VOI Epsilon GH/452R.V1 (B.1.429+B.1.427) first detected in USA/California&quot;
## variantsShort &quot;Epsilon&quot;                                                                  
##               [,7]                                                      
## variants      &quot;VOI Eta G/484K.V3 (B.1.525) first detected in UK/Nigeria&quot;
## variantsShort &quot;Eta&quot;                                                     
##               [,8]                                                          
## variants      &quot;VOI Iota GH/253G.V1 (B.1.526) first detected in USA/New York&quot;
## variantsShort &quot;Iota&quot;                                                        
##               [,9]                                                     
## variants      &quot;VOI Kappa G/452R.V3 (B.1.617.1) first detected in India&quot;
## variantsShort &quot;Kappa&quot;                                                  
##               [,10]                                                
## variants      &quot;VOI Lambda GR/452Q.V1 (C.37) first detected in Peru&quot;
## variantsShort &quot;Lambda&quot;                                             
##               [,11]                                               
## variants      &quot;VOI Zeta GR/484K.V2 (P.2) first detected in Brazil&quot;
## variantsShort &quot;Zeta&quot;</code></pre>
<pre class="r"><code># Assign shorter name
for(i in seq_along(variants)){
  dat[which(dat$Variant == variants[i]), &quot;VariantShort&quot;] &lt;- variantsShort[i]
}</code></pre>
<p>Load TESSy</p>
<pre class="r"><code>dlData &lt;- FALSE # Whether to download the data again from the ECDC website
source(&quot;TESSy.R&quot;)</code></pre>
</div>
<div id="beta" class="section level3">
<h3>Beta</h3>
<pre class="r"><code>tessy.Beta &lt;- (dat.tessy.FR$variant == &quot;B.1.351&quot;)
tmp &lt;- dat.tessy.FR[tessy.Beta, ]


# Aggregate the data by week of collection
tmp.nBeta &lt;- aggregate(tmp$number_detections_variant, by = list(week = tmp$week), FUN = sum)
# Number of sequences that week
tmp.n &lt;- aggregate(dat.tessy.FR$number_detections_variant, by = list(week = dat.tessy.FR$week), FUN = sum, na.rm = TRUE)
tmp.n2 &lt;- aggregate(dat.tessy.FR$number_sequenced, by = list(week = dat.tessy.FR$week), FUN = unique, na.rm = TRUE)
cbind(tmp.n, tmp.n2)</code></pre>
<pre><code>##   week    x week    x
## 1   19 3013   19 3013
## 2   20 1483   20 1483
## 3   21 3040   21 3040
## 4   22 1094   22 1094
## 5   23 1791   23 1791
## 6   24  760   24  760
## 7   25 1798   25 1798
## 8   26 1466   26 1466</code></pre>
<pre class="r"><code># Merge and name
tessyBeta.byweek &lt;- merge(tmp.nBeta, tmp.n, by = &quot;week&quot;)
names(tessyBeta.byweek) &lt;- c(&quot;week&quot;, &quot;nBeta&quot;, &quot;n&quot;)
tessyBeta.byweek$p &lt;- tessyBeta.byweek$nBeta / tessyBeta.byweek$n
# Confidence interval for proportion
tessyBeta.byweek$deltaCI &lt;- with(tessyBeta.byweek, 1.96 * sqrt(p * (1-p)/n))

tessyBeta.byweek</code></pre>
<pre><code>##   week nBeta    n          p     deltaCI
## 1   19   305 3013 0.10122801 0.010770395
## 2   20   182 1483 0.12272421 0.016700085
## 3   21   292 3040 0.09605263 0.010474794
## 4   22    85 1094 0.07769653 0.015862993
## 5   23   158 1791 0.08821887 0.013135129
## 6   24    50  760 0.06578947 0.017625841
## 7   25   202 1798 0.11234705 0.014597002
## 8   26    55 1466 0.03751705 0.009727472</code></pre>
<pre class="r"><code># Same with GISAID data on TESSy
gisaidTESSy.Beta &lt;- (dat.gisaid.FR$variant == &quot;B.1.351&quot;)
gisaidTESSy.byweek &lt;- dat.gisaid.FR[which(gisaidTESSy.Beta), ]

# Are there duplicate values
stopifnot(!any(duplicated(tmp$year_week)))

# Total number of detection
sum(gisaidTESSy.byweek$number_detections_variant)

gisaidTESSy.byweek$p &lt;- gisaidTESSy.byweek$number_detections_variant / gisaidTESSy.byweek$number_sequenced

# Confidence interval for proportion
gisaidTESSy.byweek$deltaCI &lt;- with(gisaidTESSy.byweek, 1.96 * sqrt(p * (1-p)/number_sequenced))

gisaidTESSy.byweek</code></pre>
<pre class="r"><code>par(mfrow = c(1,1))
is.Beta &lt;- dat$VariantShort == &quot;Beta&quot;

# Aggregate the data by week of collection
tmp.mean &lt;- aggregate(is.Beta, by = list(week = dat$Collection.week), FUN = mean)
# Number of sequences that week
tmp.n &lt;- aggregate(is.Beta, by = list(week = dat$Collection.week), FUN = length)
# Merge and name
Beta.byweek &lt;- merge(tmp.mean, tmp.n, by = &quot;week&quot;)
names(Beta.byweek) &lt;- c(&quot;week&quot;, &quot;p&quot;, &quot;n&quot;)
# Confidence interval for proportion
Beta.byweek$deltaCI &lt;- with(Beta.byweek, 1.96 * sqrt(p * (1-p)/n))

par(las = 1, mar = c(4, 4, 3, 4), 
    mgp = c(2.5, 0.5, 0), tck = -0.015, 
    xpd = FALSE)
plot(Beta.byweek$week, Beta.byweek$p, 
     xlim = c(19, max(Beta.byweek$week)) + c(-1, 0), 
     xlab = &quot;&quot;, ylab = &quot;Proportion Beta&quot;, ylim = c(0, 0.225), 
     frame.plot = FALSE, yaxs = &quot;i&quot;, main = &quot;Beta&quot;, 
     type = &quot;n&quot;, 
     axes = FALSE)
axis(4)
axis(1, at =  seq(18, max(Beta.byweek$week), by = 1))
axis(2)
mtext(side = 1, text = &quot;Collection week (* = Flash week)&quot;, line = 2)

deltaX &lt;- 0.04 # Offset

for(i in seq(0, 1, by = 0.05)) abline(h = i, col = gray(0.9))

points(Beta.byweek$week, Beta.byweek$p, col = cols[&quot;GISAID&quot;], pch = pchs[&quot;GISAID&quot;])

arrows(x0 = Beta.byweek$week, y0 = Beta.byweek$p + Beta.byweek$deltaCI, 
       x1 = Beta.byweek$week, y1 = Beta.byweek$p - Beta.byweek$deltaCI, 
       code = 3, angle = 90, length = 0.00, col = cols[&quot;GISAID&quot;])

# Add TESSy data
points(as.numeric(tessyBeta.byweek$week) - 2*deltaX, tessyBeta.byweek$p, col = cols[&quot;TESSy&quot;], pch = pchs[&quot;TESSy&quot;])

arrows(x0 = as.numeric(tessyBeta.byweek$week) - 2*deltaX, y0 = tessyBeta.byweek$p + tessyBeta.byweek$deltaCI, 
       x1 = as.numeric(tessyBeta.byweek$week) - 2*deltaX, y1 = tessyBeta.byweek$p - tessyBeta.byweek$deltaCI, 
       code = 3, angle = 90, length = 0.00, col = cols[&quot;TESSy&quot;])

# Add TESSy GISAID data
points(as.numeric(gisaidTESSy.byweek$week) - deltaX, gisaidTESSy.byweek$p, col = cols[&quot;GISAID&quot;], pch = pchs[&quot;TESSyGISAID&quot;])

arrows(x0 = as.numeric(gisaidTESSy.byweek$week) - deltaX, y0 = gisaidTESSy.byweek$p + gisaidTESSy.byweek$deltaCI, 
       x1 = as.numeric(gisaidTESSy.byweek$week) - deltaX, y1 = gisaidTESSy.byweek$p - gisaidTESSy.byweek$deltaCI, 
       code = 3, angle = 90, length = 0.00, col = cols[&quot;GISAID&quot;])


# Add Flash data
dat.Flash.beta &lt;- dat.Flash[dat.Flash$Variant_short == &quot;Beta&quot;, ]

points(dat.Flash.beta$week + deltaX, dat.Flash.beta$Proportion, col = adjustcolor(cols[&quot;Flash&quot;], 0.8), pch = pchs[&quot;Flash&quot;])
arrows(x0 = as.numeric(dat.Flash.beta$week) + deltaX, y0 = dat.Flash.beta$Proportion + dat.Flash.beta$deltaCI, 
       x1 = as.numeric(dat.Flash.beta$week) + deltaX, y1 = dat.Flash.beta$Proportion - dat.Flash.beta$deltaCI, 
       code = 3, angle = 90, length = 0.00, col = cols[&quot;Flash&quot;])

# Add Flash data without Outre-Mer
points(totFlash.noOM$week + 2*deltaX, totFlash.noOM$pBeta, col = cols[&quot;Flash&quot;], pch = pchs[&quot;Flash2&quot;])
arrows(x0 = as.numeric(totFlash.noOM$week) + 2*deltaX, y0 = totFlash.noOM$pBeta + totFlash.noOM$deltaCI, 
       x1 = as.numeric(totFlash.noOM$week) + 2*deltaX, y1 = totFlash.noOM$pBeta - totFlash.noOM$deltaCI, 
       code = 3, angle = 90, length = 0.00, col = cols[&quot;Flash&quot;])


par(xpd = TRUE)
text(datesFlash[datesFlash$week &gt;=18, &quot;week&quot;], -0.02, &quot;*&quot;)
par(xpd = FALSE)
legend(&quot;topleft&quot;, col = cols[c(&quot;TESSy&quot;, &quot;GISAID&quot;, &quot;GISAID&quot;, &quot;Flash&quot;, &quot;Flash&quot;)], legend = c(&quot;EDCD, source TESSy&quot;, &quot;ECDC, source GISAID&quot;, &quot;GISAID with country = France&quot;, &quot;Flash surveys&quot;, &quot;Flash surveys without Overseas France&quot;), pch = pchs[c(&quot;TESSy&quot;, &quot;TESSyGISAID&quot;, &quot;GISAID&quot;, &quot;Flash&quot;, &quot;Flash2&quot;)], bty = &quot;n&quot;)</code></pre>
<p><img src="figuresFrance_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<p>There are 2149 Beta sequences.</p>
<p>This is 0.0374266 of all sequences.<br />
This is 0.0570954 of sequences collected since April (included) This is 0.0551019 of sequences collected since May (included) This is 0.0426794 of sequences collected since June (included)</p>
<pre class="r"><code>tessyBeta.byweek</code></pre>
<pre><code>##   week nBeta    n          p     deltaCI
## 1   19   305 3013 0.10122801 0.010770395
## 2   20   182 1483 0.12272421 0.016700085
## 3   21   292 3040 0.09605263 0.010474794
## 4   22    85 1094 0.07769653 0.015862993
## 5   23   158 1791 0.08821887 0.013135129
## 6   24    50  760 0.06578947 0.017625841
## 7   25   202 1798 0.11234705 0.014597002
## 8   26    55 1466 0.03751705 0.009727472</code></pre>
<pre class="r"><code>sum(tessyBeta.byweek$nBeta)</code></pre>
<pre><code>## [1] 1329</code></pre>
<pre class="r"><code>sum(tessyBeta.byweek$nBeta)/sum(tessyBeta.byweek$n)</code></pre>
<pre><code>## [1] 0.09200415</code></pre>
<pre class="r"><code>sum(unique(dat.tessy.FR$number_sequenced))</code></pre>
<pre><code>## [1] 14445</code></pre>
</div>
</div>
<div id="aa-changes" class="section level2">
<h2>AA changes</h2>
<p>Load screening data (criblage)</p>
<pre class="r"><code>source(&quot;publicData_criblage.R&quot;)</code></pre>
<pre class="r"><code># Extract AA
tmp &lt;- gsub(&#39;\\(&#39;, &#39;&#39;, dat$AA.Substitutions)
tmp &lt;- gsub(&#39;\\)&#39;, &#39;&#39;, tmp)
aa &lt;- strsplit(tmp, &quot;,&quot;)</code></pre>
<div id="l452r" class="section level4">
<h4>L452R</h4>
<pre class="r"><code># Extract information on whether the S:L452R is present as aa substitution in the sequence
i.L452R &lt;- sapply(aa, function(x){(is.element(&quot;Spike_L452R&quot;, x))})</code></pre>
<p>Overall, fraction of all sequences with the L452R mutation: 0.0447935.</p>
<pre class="r"><code># Aggregate the data by week of collection
# Proportion of sequences with L452R that week
tmp.mean &lt;- aggregate(i.L452R, by = list(week = dat$Collection.week), FUN = mean)
# Number of sequences that week
tmp.n &lt;- aggregate(i.L452R, by = list(week = dat$Collection.week), FUN = length)
# Merge and name
L452R.byweek &lt;- merge(tmp.mean, tmp.n, by = &quot;week&quot;)
names(L452R.byweek) &lt;- c(&quot;week&quot;, &quot;p&quot;, &quot;n&quot;)
# Confidence interval for proportion
L452R.byweek$deltaCI &lt;- with(L452R.byweek, 1.96 * sqrt(p * (1-p)/n))</code></pre>
<p>Which variant harbor the L452R mutation?</p>
<pre class="r"><code>table(dat[which(dat$Collection.week &gt;= 21 &amp; i.L452R), &quot;VariantShort&quot;])</code></pre>
<pre><code>## 
##           Alpha   Delta Epsilon   Kappa 
##      72      10    1661       2       1</code></pre>
<pre class="r"><code>dat.France$deltaCI_C1 &lt;- 1.96 * sqrt(dat.France$tx_C1/100 * (1-dat.France$tx_C1/100) / (dat.France$nb_C1 + dat.France$nb_C0))</code></pre>
<pre class="r"><code>par(las = 1, mar = c(4, 4, 3, 4), 
    mgp = c(2., 0.5, 0), tck = -0.02, 
    xpd = FALSE)
plot(L452R.byweek$week, L452R.byweek$p, xlim = range(dat.France$week, na.rm = TRUE) + c(-1, 0), 
     xlab = &quot;Collection week&quot;, ylab = &quot;Proportion L452R&quot;, ylim = c(0, 1), 
     frame.plot = FALSE, yaxs = &quot;i&quot;, col = cols[&quot;GISAID&quot;], pch = 16, main = &quot;L452R&quot;)
axis(4)

for(i in seq(0, 1, by = 0.1)) abline(h = i, col = gray(0.9))

arrows(x0 = L452R.byweek$week, y0 = L452R.byweek$p + L452R.byweek$deltaCI, 
       x1 = L452R.byweek$week, y1 = L452R.byweek$p - L452R.byweek$deltaCI, 
       code = 3, angle = 90, length = 0.1, col = cols[&quot;GISAID&quot;])

points(dat.France$week, dat.France$tx_C1/100, col = cols[&quot;criblage&quot;], pch = 18)

arrows(x0 = dat.France$week, y0 = dat.France$tx_C1/100 + dat.France$deltaCI_C1, 
       x1 = dat.France$week, y1 = dat.France$tx_C1/100 - dat.France$deltaCI_C1, 
       code = 3, angle = 90, length = 0.1, col = cols[&quot;criblage&quot;])

legend(&quot;topleft&quot;, col = cols[c(&quot;GISAID&quot;, &quot;criblage&quot;)], legend = c(&quot;in GISAID with country = France&quot;, &quot;Criblage&quot;), pch = c(16, 18), bty = &quot;n&quot;)

par(xpd = TRUE)
text(datesFlash[which(datesFlash$week &gt;= min(dat.France$week, na.rm = TRUE) -1), &quot;week&quot;], -0.125, &quot;*&quot;)</code></pre>
<p><img src="figuresFrance_files/figure-html/unnamed-chunk-36-1.png" width="672" /></p>
<p>Que se passe-t-il en semaine 24-25 ? Nombres de sequences par regions</p>
<pre class="r"><code>tmp25 &lt;- dat[which(i.L452R &amp; dat$Collection.week == 25), ]
table(tmp25$region)</code></pre>
<pre><code>## 
##      AUVERGNERHONEALPES   BOURGOGNEFRANCHECOMTE                BRETAGNE 
##                     196                      38                       2 
##        CENTREVALDELOIRE                GRANDEST           HAUTSDEFRANCE 
##                      22                      36                       4 
##             ILEDEFRANCE               NORMANDIE       NOUVELLEAQUITAINE 
##                     133                       3                      66 
##               OCCITANIE           PAYSDELALOIRE             PAYSDELOIRE 
##                      26                       3                       2 
## PROVENCEALPESCOTED&#39;AZUR 
##                      13</code></pre>
<pre class="r"><code>tmp24 &lt;- dat[which(i.L452R &amp; dat$Collection.week == 24), ]
table(tmp24$region)</code></pre>
<pre><code>## 
##      AUVERGNERHONEALPES   BOURGOGNEFRANCHECOMTE        CENTREVALDELOIRE 
##                      33                       4                       5 
##                GRANDEST           HAUTSDEFRANCE             ILEDEFRANCE 
##                       6                      12                      43 
##       NOUVELLEAQUITAINE               OCCITANIE           PAYSDELALOIRE 
##                      14                       5                       5 
## PROVENCEALPESCOTED&#39;AZUR 
##                       2</code></pre>
</div>
<div id="e484k" class="section level4">
<h4>E484K</h4>
<pre class="r"><code># Extract information on whether the S:E484K is present as aa substitution in the sequence
i.E484K &lt;- sapply(aa, function(x){(is.element(&quot;Spike_E484K&quot;, x))})
mean(i.E484K)</code></pre>
<pre><code>## [1] 0.08645222</code></pre>
<pre class="r"><code># Aggregate the data by week of collection
# Proportion of sequences with L452R that week
tmp.mean &lt;- aggregate(i.E484K, by = list(week = dat$Collection.week), FUN = mean)
# Number of sequences that week
tmp.n &lt;- aggregate(i.E484K, by = list(week = dat$Collection.week), FUN = length)
# Merge and name
E484K.byweek &lt;- merge(tmp.mean, tmp.n, by = &quot;week&quot;)
names(E484K.byweek) &lt;- c(&quot;week&quot;, &quot;p&quot;, &quot;n&quot;)
# Confidence interval for proportion
E484K.byweek$deltaCI &lt;- with(E484K.byweek, 1.96 * sqrt(p * (1-p)/n))</code></pre>
<pre class="r"><code>table(dat[which(dat$Collection.week &gt;= 21 &amp; i.E484K), &quot;VariantShort&quot;])</code></pre>
<pre><code>## 
##       Alpha  Beta Delta   Eta Gamma  Iota 
##   198   147   251     1    68   151     1</code></pre>
<pre class="r"><code>dat.France$deltaCI_A1 &lt;- 1.96 * sqrt(dat.France$tx_A1/100 * (1-dat.France$tx_A1/100) / (dat.France$nb_A1 + dat.France$nb_A0))</code></pre>
<pre class="r"><code>par(las = 1, mar = c(4, 4, 3, 4), 
    mgp = c(2., 0.5, 0), tck = -0.02, 
    xpd = FALSE)
plot(E484K.byweek$week, E484K.byweek$p, xlim = range(dat.France$week, na.rm = TRUE) + c(-1, 0), 
     xlab = &quot;Collection week&quot;, ylab = &quot;Proportion E484K&quot;, ylim = c(0, 1), 
     frame.plot = FALSE, yaxs = &quot;i&quot;, col = cols[&quot;GISAID&quot;], pch = 16, main = &quot;E484K&quot;)
axis(4)

for(i in seq(0, 1, by = 0.1)) abline(h = i, col = gray(0.9))

arrows(x0 = E484K.byweek$week, y0 = E484K.byweek$p + E484K.byweek$deltaCI, 
       x1 = E484K.byweek$week, y1 = E484K.byweek$p - E484K.byweek$deltaCI, 
       code = 3, angle = 90, length = 0.1, col = cols[&quot;GISAID&quot;])

points(dat.France$week, dat.France$tx_A1/100, col = cols[&quot;criblage&quot;], pch = 18)

arrows(x0 = dat.France$week, y0 = dat.France$tx_A1/100 + dat.France$deltaCI_A1, 
       x1 = dat.France$week, y1 = dat.France$tx_A1/100 - dat.France$deltaCI_A1, 
       code = 3, angle = 90, length = 0.1, col = cols[&quot;criblage&quot;])

legend(&quot;topleft&quot;, col = cols[c(&quot;GISAID&quot;, &quot;criblage&quot;)], legend = c(&quot;in GISAID with country = France&quot;, &quot;Criblage&quot;), pch = c(16, 18), bty = &quot;n&quot;)

par(xpd = TRUE)
text(datesFlash[which(datesFlash$week &gt;= min(dat.France$week, na.rm = TRUE) -1), &quot;week&quot;], -0.125, &quot;*&quot;)</code></pre>
<p><img src="figuresFrance_files/figure-html/unnamed-chunk-41-1.png" width="672" /></p>
<pre class="r"><code>par(las = 1)
plot(dat.France$week, dat.France$nb_pos/7 * dat.France$tx_A1/100, col = cols[&quot;criblage&quot;], pch = 18, 
     yaxs = &quot;i&quot;, 
     frame.plot = FALSE, ylim = c(0, 1.05*max(dat.France$nb_pos/7 * dat.France$tx_A1/100)), 
     xlab = &quot;week&quot;, ylab = &quot;nb of cases with E484K&quot;, main = &quot;E484K mutation&quot;)

arrows(x0 = dat.France$week, y0 = dat.France$nb_pos/7 * (dat.France$tx_A1/100 + dat.France$deltaCI_A1), 
       x1 = dat.France$week, y1 = dat.France$nb_pos/7 * (dat.France$tx_A1/100 - dat.France$deltaCI_A1), 
       code = 3, angle = 90, length = 0.1, col = cols[&quot;criblage&quot;])</code></pre>
<p><img src="figuresFrance_files/figure-html/unnamed-chunk-42-1.png" width="672" /></p>
<pre class="r"><code>for(cw in 22:28){
  tmp &lt;- dat[which(dat$Collection.week == cw &amp; i.E484K), ]
  print(cw)
  tb &lt;- table(tmp$VariantShort)
  print(tb)
  print(c(sum(tb), tb[&quot;Beta&quot;], tb[&quot;Beta&quot;]/sum(tb)))
}</code></pre>
<pre><code>## [1] 22
## 
##       Alpha  Beta   Eta Gamma 
##    29    12    33     5     3 
##                Beta      Beta 
## 82.000000 33.000000  0.402439 
## [1] 23
## 
##       Alpha  Beta   Eta Gamma 
##    39    37    47    11    13 
##                    Beta        Beta 
## 147.0000000  47.0000000   0.3197279 
## [1] 24
## 
##       Alpha  Beta   Eta Gamma 
##    13    17    20     6    11 
##                  Beta       Beta 
## 67.0000000 20.0000000  0.2985075 
## [1] 25
## 
##       Alpha  Beta   Eta Gamma 
##    39    39    50     6    88 
##                    Beta        Beta 
## 222.0000000  50.0000000   0.2252252 
## [1] 26
## 
##       Alpha  Beta Delta   Eta Gamma 
##    21     9    30     1     2    25 
##                  Beta       Beta 
## 88.0000000 30.0000000  0.3409091 
## [1] 27
## 
##       Alpha  Beta 
##    14     6     4 
##                  Beta       Beta 
## 24.0000000  4.0000000  0.1666667 
## [1] 28
## &lt; table of extent 0 &gt;
## [1]  0 NA NA</code></pre>
<pre class="r"><code>table(dat[which(dat$Collection.week &gt;= 21 &amp; i.E484K), &quot;VariantShort&quot;])</code></pre>
<pre><code>## 
##       Alpha  Beta Delta   Eta Gamma  Iota 
##   198   147   251     1    68   151     1</code></pre>
</div>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
